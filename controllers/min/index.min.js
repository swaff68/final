var Request=require("../models/request.js"),accountSid="ACa95b3f3758879b557dd75a2f33680c7d",authToken="10034e5971d871bf22b35c3f784430fa",client=require("twilio")(accountSid,authToken),indexController={index:function(t,e){Request.find({},function(t,n){console.log(n),e.render("index",{requests:n})})},requestMarkers:function(t,e){Request.find({requestFullfilled:!1},function(t,n){e.send(n)})},reliefStatus:function(t,e){console.log("Request called");var n={clothes:{displayName:"Clothing",id:"clothing",icon:" fa fa-group fa-icon",requests:0,quantity:0},lodge:{displayName:"Lodging",id:"lodging",icon:" fa fa-home fa-icon",requests:0,quantity:0},meals:{displayName:"Meals",id:"meals",icon:" fa fa-cutlery fa-icon",requests:0,quantity:0},pets:{displayName:"Pet Boarding",id:"pet-boarding",icon:" fa fa-paw fa-icon",requests:0,quantity:0},transport:{displayName:"Transportation",id:"transportation",icon:" fa fa-car fa-icon",requests:0,quantity:0},water:{displayName:"Bottles of Water",id:"water",icon:" fa fa-tint fa-icon",requests:0,quantity:0}};Request.find({requestFullfilled:!1},function(t,i){for(var s=0;s<i.length;s++){if("water"===i[s].requestType&&i[s].quantityRequested>0){n.water.requests+=1,n.water.quantity+=i[s].quantityRequested;for(var u=0;u<i[s].contributions.length;u++)n.water.quantity-=i[s].contributions[u].quantityContributed}if("clothing"===i[s].requestType&&i[s].quantityRequested>0){n.clothes.requests+=1,n.clothes.quantity+=i[s].quantityRequested;for(var u=0;u<i[s].contributions.length;u++)n.clothes.quantity-=i[s].contributions[u].quantityContributed}"pets"===i[s].requestType&&i[s].quantityRequested>0&&(n.pets.requests+=1,n.pets.quantity+=i[s].quantityRequested),"lodging"===i[s].requestType&&i[s].quantityRequested>0&&(n.lodge.requests+=1,n.lodge.quantity+=i[s].quantityRequested),"meals"===i[s].requestType&&i[s].quantityRequested>0&&(n.meals.requests+=1,n.meals.quantity+=i[s].quantityRequested),"transportation"===i[s].requestType&&i[s].quantityRequested>0&&(n.transport.requests+=1,n.transport.quantity+=i[s].quantityRequested)}console.log(n),e.send(n)})},reliefRequests:function(t,e){Request.find({requestFullfilled:!1},function(t,n){e.send(n)})},aidSubmit:function(t,e){var n=new Request(t.body);n.save(function(t,n){t?e.send(500,"ERROR"):e.send(n)})},contSubmit:function(t,e){client.messages.create({body:"Hello Swaff You Did it!",to:"7036630561",from:"7033489714"},function(t,e){process.stdout.write(e.sid)});var n=JSON.parse(t.body.contributions);console.log(JSON.parse(t.body.contributions)),n.map(function(t){Request.findOne({_id:t._id},function(e,n){n.contributions.push(t);for(var i=0,s=0;s<n.contributions.length;s++)i+=n.contributions[s].quantityContributed||0;console.log(i,n.quantityRequested),i>=n.quantityRequested&&(n.requestFullfilled=!0),console.log(n.contributions),n.save(function(){})})}),e.send("ok")}};module.exports=indexController;