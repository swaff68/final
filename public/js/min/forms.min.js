var updateStatus=function(){$.get("/reliefStatus",function(t){$(".status-table").empty();for(requestType in t){var e=$('<div class="col-md-2 '+t[requestType].id+'"><div>'+t[requestType].displayName+'</div><div>  <i class="fa '+t[requestType].icon+'"></i><div>Current Requests</div><div class="curReq">'+t[requestType].requests+'</div><div>Quantity Still Needed</div><div class="quanStillNeeded">'+t[requestType].quantity+"</div></div>");$(".status-table").append(e)}})},processReliefRequests=function(t){$(".water-table, .meals-table, .lodge-table, .pets-table, .transport-table, .clothes-table").find("tr").not(".info").remove();for(var e=0;e<t.length;e++){var s=t[e].requestType;if("water"===s){var a=$('<tr class="req-for-cont" data-id="'+t[e]._id+'" data-req="'+t[e].requestType+'"><td><input type="checkbox" class="water-request-checkbox cbox"></td><td class="qNeeded">'+t[e].quantityRequested+'</td><td class="reqC">'+t[e].requestComments+"</td><td>"+t[e].fName+" "+t[e].lName+"</td><td>"+t[e].orgName+"</td><td>"+t[e].phone+"</td></tr>");$(".water-table").append(a)}if("meals"===s){var o=$('<tr class="req-for-cont" data-id="'+t[e]._id+'" data-req="'+t[e].requestType+'"><td><input type="checkbox" class="meals-request-checkbox cbox"></td><td class="qNeeded">'+t[e].quantityRequested+'</td><td class="reqC">'+t[e].requestComments+"</td><td>"+t[e].fName+" "+t[e].lName+"</td><td>"+t[e].orgName+"</td><td>"+t[e].phone+"</td></tr>");$(".meals-table").append(o)}if("lodging"===s){var n=$('<tr class="req-for-cont" data-id="'+t[e]._id+'" data-req="'+t[e].requestType+'"><td><input type="checkbox" class="lodge-request-checkbox cbox"></td><td class="qNeeded">'+t[e].quantityRequested+'</td><td class="reqC">'+t[e].requestComments+"</td><td>"+t[e].fName+" "+t[e].lName+"</td><td>"+t[e].orgName+"</td><td>"+t[e].phone+"</td></tr>");$(".lodge-table").append(n)}if("pets"===s){var c=$('<tr class="req-for-cont" data-id="'+t[e]._id+'" data-req="'+t[e].requestType+'"><td><input type="checkbox" class="pets-request-checkbox cbox"></td><td class="qNeeded">'+t[e].quantityRequested+'</td><td class="reqC">'+t[e].requestComments+"</td><td>"+t[e].fName+" "+t[e].lName+"</td><td>"+t[e].orgName+"</td><td>"+t[e].phone+"</td></tr>");$(".pets-table").append(c)}if("transportation"===s){var r=$('<tr class="req-for-cont" data-id="'+t[e]._id+'" data-req="'+t[e].requestType+'"><td><input type="checkbox" class="transport-request-checkbox cbox"></td><td class="qNeeded">'+t[e].quantityRequested+'</td><td class="reqC">'+t[e].requestComments+"</td><td>"+t[e].fName+" "+t[e].lName+"</td><td>"+t[e].orgName+"</td><td>"+t[e].phone+"</td></tr>");$(".transport-table").append(r)}if("clothing"===s){var l=$('<tr class="req-for-cont" data-id="'+t[e]._id+'" data-req="'+t[e].requestType+'"><td><input type="checkbox" class="clothes-request-checkbox cbox"></td><td class="qNeeded">'+t[e].quantityRequested+'</td><td class="reqC">'+t[e].requestComments+"</td><td>"+t[e].fName+" "+t[e].lName+"</td><td>"+t[e].orgName+"</td><td>"+t[e].phone+"</td></tr>");$(".clothes-table").append(l)}}$(".water-request-checkbox").on("change",function(){var t='<tr class="success"><th colspan="3" class="contResponseH">Quantity to Contribute?</th><th colspan="3" class="contComments">Contribution Comments</tr><tr class="contResponseD"><td colspan="3"><input type="text" class="qc-text water-cont-quantity cont-quantity"></td><td colspan="3"><textarea class=" cc-text water-cont-comments cont-comments" rows="1"></textarea></td></tr>';$(this).prop("checked")?$(this).closest("tr").after(t):($(this).closest("tr").next().remove(),$(this).closest("tr").next().remove())}),$(".meals-request-checkbox").on("change",function(){var t='<tr class="success"><th colspan="3" class="contResponseH">Quantity to Contribute?</th><th colspan="3" class="contComments">Contribution Comments</tr><tr class="contResponseD"><td colspan="3"><input type="text" class="qc-text meals-cont-quantity cont-quantity"></td><td colspan="3"><textarea class=" cc-text meals-cont-comments cont-comments" rows="1"></textarea></td></tr>';$(this).prop("checked")?$(this).closest("tr").after(t):($(this).closest("tr").next().remove(),$(this).closest("tr").next().remove())}),$(".pets-request-checkbox").on("change",function(){var t='<tr class="success"><th colspan="3" class="contResponseH">Quantity to Contribute?</th><th colspan="3" class="contComments">Contribution Comments</tr><tr class="contResponseD"><td colspan="3"><input type="text" class=" qc-text pets-cont-quantity cont-quantity"></td><td colspan="3"><textarea class=" cc-text pets-cont-comments cont-comments" rows="1"></textarea></td></tr>';$(this).prop("checked")?$(this).closest("tr").after(t):($(this).closest("tr").next().remove(),$(this).closest("tr").next().remove())}),$(".lodge-request-checkbox").on("change",function(){var t='<tr class="success"><th colspan="3" class="contResponseH">Quantity to Contribute?</th><th colspan="3" class="contComments">Contribution Comments</tr><tr class="contResponseD"><td colspan="3"><input type="text" class="qc-text lodge-cont-quantity cont-quantity"></td><td colspan="3"><textarea class=" cc-text lodge-cont-comments cont-comments" rows="1"></textarea></td></tr>';$(this).prop("checked")?$(this).closest("tr").after(t):($(this).closest("tr").next().remove(),$(this).closest("tr").next().remove())}),$(".transport-request-checkbox").on("change",function(){var t='<tr class="success"><th colspan="3" class="contResponseH">Quantity to Contribute?</th><th colspan="3" class="contComments">Contribution Comments</tr><tr class="contResponseD"><td colspan="3"><input type="text" class=" qc-text transport-cont-quantity cont-quantity"></td><td colspan="3"><textarea class=" cc-text transport-cont-comments cont-comments" rows="1"></textarea></td></tr>';$(this).prop("checked")?$(this).closest("tr").after(t):($(this).closest("tr").next().remove(),$(this).closest("tr").next().remove())}),$(".clothes-request-checkbox").on("change",function(){var t='<tr class="success"><th colspan="3" class="contResponseH">Quantity to Contribute?</th><th colspan="3" class="contComments">Contribution Comments</tr><tr class="contResponseD"><td colspan="3"><input type="text" class=" qc-text clothes-cont-quantity cont-quantity"></td><td colspan="3"><textarea class=" cc-text clothes-cont-comments cont-comments" rows="1"></textarea></td></tr>';$(this).prop("checked")?$(this).closest("tr").after(t):($(this).closest("tr").next().remove(),$(this).closest("tr").next().remove())})};$(function(){$("#myModal1").on("show.bs.modal",function(){$.get("/reliefRequests",processReliefRequests)}),$.get("/reliefRequests",processReliefRequests),updateStatus(),$("#reqForm").on("submit",function(t){t.preventDefault(),console.log("test");var e=$("#first-name").val(),s=$("#last-name").val(),a=$("#org-name").val(),o=$("#inputEmail1").val(),n=$("#phone-number").val(),c=$("#address").val(),r=$(".water-checkbox").is(":checked"),l=$(".meals-checkbox").is(":checked"),d=$(".lodge-checkbox").is(":checked"),i=$(".pets-checkbox").is(":checked"),u=$(".transport-checkbox").is(":checked"),p=$(".clothes-checkbox").is(":checked"),m=$("#water-quantity").val(),q=$("#water-comments").val(),h=$("#meals-quantity").val(),x=$("#meals-comments").val(),g=+$("#lodge-quantity").val(),v=$("#lodge-comments").val(),b=$("#pets-quantity").val(),y=$("#pets-comments").val(),f=$("#transport-quantity").val(),N=$("#transport-comments").val(),k=$("#clothes-quantity").val(),R=$("#clothes-comments").val();geocoder.geocode({address:c},function(t,C){if(C==google.maps.GeocoderStatus.OK){map.setCenter(t[0].geometry.location);var S="./pics/clothes.png",w=null,T="./pics/pets.png",M="./pics/transport.png",D="./pics/lodge.png",O="./pics/meals.png",Q="./pics/water.png",_="./pics/multiRequest.png",H=w,I=0;p===!0&&k>0&&(H=S,I++),u===!0&&f>0&&(H=M,I++),d===!0&&g>0&&(H=D,I++),l===!0&&h>0&&(H=O,I++),i===!0&&b>0&&(H=T,I++),r===!0&&m>0&&(H=Q,I++),I>1&&(H=_),console.log(t);var E={lat:t[0].geometry.location.lat(),lng:t[0].geometry.location.lng()},F=(+new Date).toString(36);r===!0&&$.post("/aidSubmit",{fName:e,lName:s,orgName:a,email:o,phone:n,address:c,lat:E.lat,"long":E.lng,requestType:"water",quantityRequested:m,requestComments:q,groupId:F},function(){var t=$(".water .curReq").text();t=+t+1,$(".water .curReq").text(t);var e=$(".water .quanStillNeeded").text();e=+e+g,$(".water .quanStillNeeded").text(e),updateStatus(),updateMarkers()}),l===!0&&$.post("/aidSubmit",{fName:e,lName:s,orgName:a,email:o,phone:n,address:c,lat:E.lat,"long":E.lng,requestType:"meals",quantityRequested:h,requestComments:x,groupId:F},function(){var t=$(".meals .curReq").text();t=+t+1,$(".meals .curReq").text(t);var e=$(".meals .quanStillNeeded").text();e=+e+g,$(".meals .quanStillNeeded").text(e),updateStatus(),updateMarkers()}),i===!0&&$.post("/aidSubmit",{fName:e,lName:s,orgName:a,email:o,phone:n,address:c,lat:E.lat,"long":E.lng,requestType:"pets",quantityRequested:b,requestComments:y,groupId:F},function(){var t=$(".pet-boarding .curReq").text();t=+t+1,$(".pet-boarding .curReq").text(t);var e=$(".pet-boarding .quanStillNeeded").text();e=+e+g,$(".pet-boarding .quanStillNeeded").text(e),updateStatus(),updateMarkers()}),d===!0&&$.post("/aidSubmit",{fName:e,lName:s,orgName:a,email:o,phone:n,address:c,lat:E.lat,"long":E.lng,requestType:"lodging",quantityRequested:g,requestComments:v,groupId:F},function(){var t=$(".lodging .curReq").text();t=+t+1,$(".lodging .curReq").text(t);var e=$(".lodging .quanStillNeeded").text();e=+e+g,$(".lodging .quanStillNeeded").text(e),updateStatus(),updateMarkers()}),u===!0&&$.post("/aidSubmit",{fName:e,lName:s,orgName:a,email:o,phone:n,address:c,lat:E.lat,"long":E.lng,requestType:"transportation",quantityRequested:f,requestComments:N,groupId:F},function(){var t=$(".transportation .curReq").text();t=+t+1,$(".transportation .curReq").text(t);var e=$(".transportation .quanStillNeeded").text();e=+e+g,$(".transportation .quanStillNeeded").text(e),updateStatus(),updateMarkers()}),p===!0&&$.post("/aidSubmit",{fName:e,lName:s,orgName:a,email:o,phone:n,address:c,lat:E.lat,"long":E.lng,requestType:"clothing",quantityRequested:k,requestComments:R,groupId:F},function(){var t=$(".clothing .curReq").text();t=+t+1,$(".clothing .curReq").text(t);var e=$(".clothing .quanStillNeeded").text();e=+e+g,$(".clothing .quanStillNeeded").text(e),updateStatus(),updateMarkers()}),$("#myModal").fadeOut(),$(".modal-backdrop").fadeOut()}else alert("Geocode was not successful for the following reason: "+C)})}),$(".checkbox label input").on("change",function(){$(this).prop("checked")===!0?$(this).parent().siblings("input, textarea, table").show():$(this).parent().siblings("input, textarea, table").hide()}),$("#contForm").on("submit",function(t){t.preventDefault();var e=$("#first-name-cont").val(),s=$("#last-name-cont").val(),a=$("#org-name-cont").val(),o=$("#inputEmail1-cont").val(),n=$("#phone-number-cont").val(),c=[];$(".req-for-cont :checked").parents("tr").each(function(){var t=$(this).data("id");console.log(t);var r=$(this).next().next(),l=$(r).find(".qc-text").val(),d=$(r).find(".cc-text").val(),i={_id:t,quantityContributed:l,contributionComments:d,contributorFName:e,contributorLName:s,contributorOrgName:a,contributorEmail:o,contributorPhone:n};c.push(i)}),$.post("/contSubmit",{contributions:JSON.stringify(c)},function(){updateMarkers(),updateStatus()}),$("#myModal1").fadeOut(),$(".modal-backdrop").fadeOut()}),$("#metricsBtn").one("click",function(){new Morris.Line({element:"myfirstchart",data:[{year:"2008",value:20},{year:"2009",value:10},{year:"2010",value:5},{year:"2011",value:5},{year:"2012",value:20}],xkey:"year",ykeys:["value"],labels:["Value"]})})});